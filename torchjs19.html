<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0"></script>

<body>

<h2 align="center">torchjs19.html - Stable Vector Map Lab</h2>

<div style="font-size:15px; background-color:lightyellow; width:88%; border:5px solid blue; padding:5px; margin:5px;"> 
<b>Vector Logic:</b> Words are stored as coordinates (Embeddings). 
Edit the <b>JSON</b> in the blue box or the code in the black box, then click <b>Update and Run</b> to see the map change!
</div><br>

<div id="myCodeSpace">
  <div style="display: flex; gap: 20px; padding: 10px; flex-wrap: wrap;">
    
    <div style="flex: 1.5; min-width: 300px; border: 2px solid green; padding: 10px; text-align: center;">
      <b>AI Semantic Map (2D)</b><br>
      <canvas id="myCanvas1" width="400" height="300" style="border:1px solid black; background: #fafafa;"></canvas>
    </div>

    <div style="flex: 1; min-width: 300px; border: 2px solid blue; padding: 10px;">
      <b>1. Select Focal Word:</b><br>
      <select id="myWordSelect" onchange="myDrawMap()" style="font-size:16px; width:100%;">
        <option value="cat">cat</option>
        <option value="dog">dog</option>
        <option value="apple">apple</option>
        <option value="orange">orange</option>
        <option value="computer">computer</option>
      </select>
      <br><br>
      <b>2. Edit Word Coordinates (Embeddings):</b><br>
      <textarea id="myVectorJSON" rows="8" style="width: 95%; font-family: monospace;" oninput="myDrawMap()">
{
  "cat": [50, 60],
  "dog": [70, 80],
  "apple": [300, 200],
  "orange": [320, 220],
  "computer": [200, 50]
}
      </textarea>
    </div>
  </div>

  <div id="myDivHistory" style="border: 2px solid orange; padding: 10px; margin: 10px; font-family: monospace; background-color: #fff4e6; min-height: 80px;">
    Select a word to see its "Semantic Distance" from others.
  </div>

  <script>
    function myDrawMap() {
      const myCanvas = document.getElementById('myCanvas1');
      const myCtx = myCanvas.getContext('2d');
      const mySelectedWord = document.getElementById('myWordSelect').value;
      const myJSONArea = document.getElementById('myVectorJSON');
      
      try {
        const myData = JSON.parse(myJSONArea.value);
        myCtx.clearRect(0, 0, myCanvas.width, myCanvas.height);
        
        let focalX = myData[mySelectedWord][0];
        let focalY = myData[mySelectedWord][1];
        let myReport = `<b>Semantic Distance from "${mySelectedWord}":</b><br>`;

        Object.keys(myData).forEach(myWord => {
          let myX = myData[myWord][0];
          let myY = myData[myWord][1];
          let isFocal = (myWord === mySelectedWord);

          // Draw the Word Point
          myCtx.beginPath();
          myCtx.arc(myX, myY, isFocal ? 8 : 5, 0, Math.PI * 2);
          myCtx.fillStyle = isFocal ? "red" : "blue";
          myCtx.fill();
          
          // Draw the Label
          myCtx.fillStyle = "black";
          myCtx.font = isFocal ? "bold 14px Arial" : "12px Arial";
          myCtx.fillText(myWord, myX + 10, myY + 5);

          // Calculate Euclidean Distance
          if (!isFocal) {
            const myDist = Math.sqrt(Math.pow(myX - focalX, 2) + Math.pow(myY - focalY, 2)).toFixed(1);
            let myStar = myDist < 80 ? 'â­ (Related)' : '';
            myReport += `${myWord}: ${myDist} units ${myStar}<br>`;
          }
        });

        document.getElementById('myDivHistory').innerHTML = myReport;

      } catch(e) {
         document.getElementById('myDivHistory').innerHTML = "<b style='color:red;'>JSON Syntax Error!</b>";
      }
    }
  </script>
</div>

<input id="myUpdateBtn" type="button" value="Update and Run" style="visibility:hidden; background-color: yellow;" onclick="myApplyAndRun()"><br>

<textarea id="myTextarea1" wrap="off" rows="2" style="width:95%; background:black; color:white; font-family:monospace; margin:10px;" onclick="myToggleEditor()">
Click here to see the Vector Map logic...
</textarea>

<script>
let myOnce = true;

function myToggleEditor() {
    if (myOnce) {
       myTextGrow('myTextarea1', 'myCodeSpace');
       document.getElementById('myUpdateBtn').style.visibility = 'visible';
       myOnce = false;
    }
}

function myApplyAndRun() {
  let myLines = document.getElementById('myTextarea1').value.split('\n');
  myLines.shift(); // Remove script src
  myLines.shift(); // Remove spacer
  myLines.pop();   // Remove div wrapper
  
  document.getElementById('myCodeSpace').innerHTML = myLines.join('\n');
  myDrawMap(); 
}

function myTextGrow(myT, myC) {
   const myArea = document.getElementById(myT);
   myArea.value = '\x3Cscript src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0">\x3C/script>\n\n' + document.getElementById(myC).innerHTML;
   myArea.value += "\n<div id='myDivHistory'>...</div>";
   setTimeout(() => { myArea.rows = myArea.value.split('\n').length + 3; }, 100);
}

window.onload = myDrawMap;
</script>

</body>