<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0"></script>

<body>

<h2 align="center">As easy as I can make torchjs06.html (Deep Brain)</h2>

<div style="font-size:15px; background-color:lightyellow; width:88%;  border:5px solid blue; padding:5px; margin:5px;"> 
This matches our <b>torch06.py</b> logic. We want to learn a non-linear pattern: <b>y = |x|</b>.<br><br>
Inputs: <b>[-2, -1, 0, 1, 2]</b> | Targets: <b>[2, 1, 0, 1, 2]</b><br>
This requires a <b>Hidden Layer</b> and a <b>ReLU</b> activation function to learn the "V" shape.<br>
Click the button to train, then edit the code to try adding more neurons to the hidden layer!
</div><br>

<div id="myCodeSpace"> 
  <input id="myButton1" type="button" value="Run torchjs06 Logic" onclick="{
    (async function myGo() {
      document.getElementById('myButton1').style.backgroundColor = 'red';
      const myDisplay = document.getElementById('myDiv1');
      myDisplay.innerHTML = ''; 

      // 1. Setup Data - Matches torch06.py Step 2
      const myInputs = tf.tensor2d([[-2.0], [-1.0], [0.0], [1.0], [2.0]]);
      const myTargets = tf.tensor2d([[2.0], [1.0], [0.0], [1.0], [2.0]]);

      // 2. Define the Deep Model - Matches torch06.py class myDeepBrain
      const myModel = tf.sequential();
      // Layer 1: 1 input to 5 hidden neurons
      myModel.add(tf.layers.dense({units: 5, inputShape: [1], activation: 'relu'})); 
      // Layer 2: 5 neurons down to 1 output
      myModel.add(tf.layers.dense({units: 1}));

      // 3. Setup Optimizer and Loss - Matches torch06.py Step 3
      const myLearningRate = 0.01;
      const myOptimizer = tf.train.adam(myLearningRate); // Adam is smarter than SGD
      myModel.compile({optimizer: myOptimizer, loss: 'meanSquaredError'});

      // 4. Training Loop - Matches torch06.py Step 3
      const myEpochs = 501;
      await myModel.fit(myInputs, myTargets, {
          epochs: myEpochs,                                                                      
          callbacks: { 
            onEpochEnd: async (epoch, logs) => {                                                                                         
              if (epoch % 100 === 0) {
                 myDisplay.innerHTML += `Epoch ${epoch}: Loss ${logs.loss.toFixed(4)}<br>`;
              }
              await tf.nextFrame();  
            }
          }
      });
                                                                                
      // 5. Test the Brain - Matches torch06.py Step 4
      const myTestVal = -1.5;
      const myResult = await myModel.predict(tf.tensor2d([[myTestVal]])).data();
      
      myDisplay.innerHTML += `<br><b>Prediction for -1.5: ${myResult[0].toFixed(2)}</b> (Should be 1.50)`;
      
      document.getElementById('myButton1').style.backgroundColor = 'lightgray';
    })();
  }"><br><br>
</div>

<div id="myDiv1" style="border: 2px solid green; padding: 10px; margin: 10px; font-family: monospace;">...</div>

<input id="myUpdateBtn" type="button" value="Update and Run" style="visibility:hidden;" onclick="{
  let myLines = document.getElementById('myTextarea1').value.split('\n');
  myLines.shift(); 
  myLines.shift(); 
  myLines.pop();   
  
  document.getElementById('myCodeSpace').innerHTML = myLines.join('\n');
  document.getElementById('myButton1').click();
}"><br>

<textarea id="myTextarea1" wrap="off" 
  style="font-size:15px; color:white; background-color:black; width:95%; font-family: 'Courier New', monospace;" rows="2" 
  onclick="{
    if (myOnce) {
       myTextGrow('myTextarea1', 'myCodeSpace');
       document.getElementById('myUpdateBtn').style.visibility = 'visible';
       myOnce = false;
    }
}">
Click here to see the working HTML/JS code.
</textarea>

<script>
let myOnce = true;

function myTextGrow(myT, myC) {
   const myArea = document.getElementById(myT);
   myArea.value = '\x3Cscript src=\'https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0\'> \x3C/script> \n\n' + document.getElementById(myC).innerHTML;
   myArea.value += '\n<div id=\'myDiv1\'>...</div>';
   
   setTimeout(() => {
      myArea.rows = myArea.value.split('\n').length + 3;
   }, 100);
}
</script>

</body>