<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0"></script>

<body>

<h2 align="center">torchjs23.html - Stable Brain Pruning</h2>

<div style="font-size:15px; background-color:lightyellow; width:88%; border:5px solid blue; padding:5px; margin:5px;"> 
<b>Pruning Logic:</b> AI models often have "lazy" neurons. We "Prune" (cut) connections that are close to zero to save speed. 
Move the slider to see the brain connections disappear and check the <b>Efficiency</b> report!
</div><br>

<div id="myCodeSpace">
  <div style="display: flex; gap: 20px; padding: 10px; flex-wrap: wrap;">
    
    <div style="flex: 1; min-width: 300px; border: 2px solid green; padding: 10px;">
      <b>1. Pruning Threshold:</b><br>
      <input type="range" id="myPruneSlider" min="0" max="100" value="10" style="width: 80%;" oninput="myPrune()">
      <span id="myPercent" style="font-weight:bold;">10</span>% Cut<br><br>
      
      <b>Active Connections:</b> 
      <div id="myCount" style="font-size: 24px; color: blue; font-weight: bold;">1000</div>
    </div>

    <div style="flex: 1.5; min-width: 300px; border: 2px solid blue; padding: 10px; text-align: center;">
      <b>2. Visual Brain Map:</b><br>
      <canvas id="myCanvasPrune" width="300" height="200" style="border:1px solid black; background: #111;"></canvas>
    </div>
  </div>

  <div id="myDivHistory" style="border: 2px solid orange; padding: 10px; margin: 10px; font-family: monospace; background-color: #fff4e6; min-height: 80px;">
    Pruning report will appear here...
  </div>

  <script>
    // Generate some random weights for the "Brain"
    var myBaseWeights = [];
    for(let i=0; i<200; i++) { myBaseWeights.push(Math.random()); }

    function myPrune() {
      const mySlider = document.getElementById('myPruneSlider');
      const myCanvas = document.getElementById('myCanvasPrune');
      const myCtx = myCanvas.getContext('2d');
      const myHistory = document.getElementById('myDivHistory');
      
      let myThreshold = mySlider.value / 100;
      document.getElementById('myPercent').innerHTML = mySlider.value;

      myCtx.clearRect(0, 0, myCanvas.width, myCanvas.height);
      let myActiveCount = 0;

      // Draw connections
      myBaseWeights.forEach((myW, i) => {
        let myX = (i % 20) * 15 + 10;
        let myY = Math.floor(i / 20) * 18 + 20;

        // The Pruning Logic: If weight is less than threshold, don't draw it!
        if (myW > myThreshold) {
          myActiveCount++;
          myCtx.beginPath();
          myCtx.moveTo(myX, myY);
          myCtx.lineTo(myX + 10, myY + 12);
          myCtx.strokeStyle = `rgba(0, 255, 0, ${myW})`;
          myCtx.lineWidth = 2;
          myCtx.stroke();
        }
      });

      document.getElementById('myCount').innerHTML = myActiveCount * 5; // Scaling for effect

      // Intelligence impact logic
      let myStatus = "Healthy";
      let myColor = "green";
      if (myThreshold > 0.4) { myStatus = "Slightly Confused"; myColor = "orange"; }
      if (myThreshold > 0.7) { myStatus = "Brain Dead"; myColor = "red"; }

      myHistory.innerHTML = `<b>Pruning Report:</b><br>
        Status: <b style="color:${myColor}">${myStatus}</b><br>
        Efficiency: AI is now <b>${ (myThreshold * 60).toFixed(0) }% faster</b>.<br>
        Hardware Note: Pruning allows smaller chips to skip unnecessary math.`;
      
      // Keep memory clean
      const myDummyTensor = tf.tensor1d(myBaseWeights);
      myDummyTensor.dispose();
    }
  </script>
</div>

<input id="myUpdateBtn" type="button" value="Update and Run" style="visibility:hidden; background-color: yellow;" onclick="myApplyAndRun()"><br>

<textarea id="myTextarea1" wrap="off" rows="2" style="width:95%; background:black; color:white; font-family:monospace; margin:10px;" onclick="myToggleEditor()">
Click here to see the Pruning source code...
</textarea>

<script>
let myOnce = true;

function myToggleEditor() {
    if (myOnce) {
       myTextGrow('myTextarea1', 'myCodeSpace');
       document.getElementById('myUpdateBtn').style.visibility = 'visible';
       myOnce = false;
    }
}

function myApplyAndRun() {
  let myLines = document.getElementById('myTextarea1').value.split('\n');
  myLines.shift(); // Remove script
  myLines.shift(); // Remove spacer
  myLines.pop();   // Remove div
  
  document.getElementById('myCodeSpace').innerHTML = myLines.join('\n');
  myPrune(); 
}

function myTextGrow(myT, myC) {
   const myArea = document.getElementById(myT);
   myArea.value = '\x3Cscript src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0">\x3C/script>\n\n' + document.getElementById(myC).innerHTML;
   myArea.value += "\n<div id='myDivHistory'>...</div>";
   setTimeout(() => { myArea.rows = myArea.value.split('\n').length + 3; }, 100);
}

window.onload = myPrune;
</script>

</body>